# n8n-ai Development Environment Setup

## 1.0 Infrastructure Migration Summary

Replaced failing Coder infrastructure with devcontainer-based workflow integrating Jules (Google AI) and Claude Code for local/cloud-agnostic development.

### 1.1 Migration Rationale

| Issue | Coder Infrastructure | Devcontainer Solution |
|-------|---------------------|----------------------|
| SSH Access | DERP networking failures | Direct localhost access |
| PostgreSQL | Crash-prone, manual restart | Service orchestration, auto-recovery |
| Docker Permissions | Manual fix post-restart | Automated configuration |
| Setup Time | 30+ minutes | 3-5 minutes |
| Cloud Portability | Coder-specific | GitHub Codespaces/GitPod compatible |

### 1.2 Architecture Components

Component | Technology | Purpose
----------|------------|--------
Dev Environment | VS Code + Docker | Hot-reload, port forwarding, service orchestration
AI Scaffolding | Jules (Google) | Full-stack code generation, review
Terminal AI | Claude Code | Pair-programming, git operations, testing
Database | PostgreSQL + pgvector | Persistence, vector storage
Cache | Redis 7 | Session management, queuing
Build System | pnpm + Taskfile | Monorepo management, automation

---

## 2.0 Prerequisites Installation

### 2.1 Required Tools

```bash
# Claude Code CLI
brew install anthropic/tap/claude-code
claude auth

# VS Code + Dev Containers Extension
brew install --cask visual-studio-code
code --install-extension ms-vscode-remote.remote-containers

# Docker Desktop (verify running)
docker --version  # Confirm ≥ 24.0.0
```

### 2.2 Verification

```bash
# Confirm installations
which claude && which code && which docker
# Expected: 3 successful path outputs
```

---

## 3.0 Development Environment Activation

### 3.1 Launch Sequence

```bash
# Navigate to project
cd /Users/td/n8n-ai

# Open in VS Code
code .
```

### 3.2 Container Initialization

VS Code will detect `.devcontainer/devcontainer.json`:
- Click "Reopen in Container" notification (bottom-right)
- Alternative: `⇧⌘P` → "Dev-Containers: Reopen in Container"

**Initial Build Duration:** 3-5 minutes  
**Subsequent Launches:** 10-20 seconds

### 3.3 Automated Setup Sequence

Post-container launch automation:
1. Node 20 + pnpm installation
2. PostgreSQL + Redis service initialization
3. `uv tool install claude-code` execution
4. `pnpm install` dependency resolution
5. `task init` database migration + seeding

---

## 4.0 Service Configuration

### 4.1 Port Forwarding

Service | URL | Purpose
--------|-----|--------
n8n-ai Dev | http://localhost:5678 | Primary application
Storybook | http://localhost:6006 | Component library
PostgreSQL | localhost:5432 | Database access
Redis | localhost:6379 | Cache access

### 4.2 Database Connection

```bash
# Connection string
postgresql://postgres:postgres@localhost:5432/n8n_ai

# Verification
psql postgresql://postgres:postgres@localhost:5432/n8n_ai -c "\dt"
```

### 4.3 Environment Variables

Located in `.env` (auto-generated by `task init`):
```bash
DATABASE_URL=postgresql://postgres:postgres@localhost:5432/n8n_ai
REDIS_URL=redis://localhost:6379
NODE_ENV=development
```

---

## 5.0 Development Workflow

### 5.1 Daily Operations

Task | Command | Description
-----|---------|------------
Start Dev Server | `task dev` | Hot-reload full stack
Run Tests | `task test` | Vitest + Playwright execution
Build Production | `task build` | Docker image generation
Component Library | `task storybook` | Launch visual component browser

### 5.2 Claude Code Integration

Operation | Command | Use Case
----------|---------|----------
Fix Errors | `claude fix` | Auto-detect and repair lint/type errors
Generate Tests | `claude test <filepath>` | Create unit test scaffolding
Explain Code | `claude explain <directory>` | Document complex modules
Git Operations | `claude git commit "message"` | Interactive staging + push
Refactor | `claude refactor <file>` | Code quality improvements

### 5.3 Jules AI Integration

**Activation Method:** GitHub Issues + PR Comments

| Task Type | Issue Command | Jules Action |
|-----------|--------------|--------------|
| Feature Scaffold | Open issue with `[FEATURE]` template | Generates implementation PR |
| Bug Fix | Open issue with `[BUG]` template | Diagnoses + proposes solution |
| Code Review | Comment `@jules review` on PR | Provides architectural feedback |
| Test Generation | Comment `@jules tests` on PR | Adds missing test coverage |

---

## 6.0 GitHub Integration

### 6.1 Issue Templates

Template | Path | Purpose
---------|------|--------
Feature Request | `.github/ISSUE_TEMPLATE/feature.yml` | Structured capability specification
Bug Report | `.github/ISSUE_TEMPLATE/bug.yml` | Defect reproduction protocol

### 6.2 Label Taxonomy

Classification | Labels | Usage
---------------|--------|------
Type | `type:feature`, `type:bug`, `type:refactor` | Work categorization
Priority | `priority:P0` through `priority:P3` | Urgency classification
Status | `status:needs-triage`, `status:ready`, `status:in-progress` | Workflow state
Component | `component:ai-service`, `component:n8n-fork`, `component:ui` | Module assignment

### 6.3 CI/CD Pipeline

**Workflow:** `.github/workflows/ci.yml`

Stage | Actions | Success Criteria
------|---------|------------------
Lint | ESLint + Prettier | Zero warnings/errors
Typecheck | TypeScript compiler | No type violations
Test | Vitest + Playwright | All tests passing
Build | Production compilation | Build artifacts generated

---

## 7.0 Cloud Migration Path

### 7.1 GitHub Codespaces

```bash
# Navigate to github.com/dewars30/n8n-ai
# Press "." (period key)
# Instant cloud container launch with identical configuration
```

### 7.2 GitPod Configuration

Create `.gitpod.yml`:
```yaml
image: gitpod/workspace-full
tasks:
  - init: pnpm install
    command: task dev
ports:
  - port: 5678
    onOpen: open-preview
```

---

## 8.0 Troubleshooting

### 8.1 Container Issues

Problem | Solution
--------|----------
Container fails to start | `docker system prune -a` → rebuild
Permission denied | Verify Docker Desktop running with full disk access
Port already in use | `lsof -ti:5678 \| xargs kill -9`

### 8.2 Service Health Checks

```bash
# PostgreSQL
docker exec -it n8n-ai-postgres-1 pg_isready

# Redis
docker exec -it n8n-ai-redis-1 redis-cli ping

# Application
curl http://localhost:5678/healthz
```

---

## 9.0 Migration Cleanup

### 9.1 Obsolete Files (Safe to Archive)

```bash
# Coder-specific infrastructure (non-functional)
main.tf
workspace-shell.sh
CODER_*.md
```

### 9.2 Preserved Components

```bash
# Reused in devcontainer configuration
taskfile.yml
docker-compose.yml (replaced by .devcontainer version)
package.json
```

---

## 10.0 Quick Reference

### 10.1 Essential Commands

```bash
# Environment
code .                    # Launch VS Code
task dev                  # Start development
task test                 # Run test suite

# Claude Code
claude fix               # Auto-repair errors
claude git commit "msg"  # Interactive git

# Container Management
docker ps                # List running services
docker logs n8n-ai-app-1 # View application logs
```

### 10.2 Configuration Files

Path | Purpose
-----|--------
`.devcontainer/devcontainer.json` | VS Code container specification
`.devcontainer/docker-compose.yml` | Service orchestration
`.github/workflows/ci.yml` | CI/CD pipeline
`.github/ISSUE_TEMPLATE/` | Jules AI integration templates
`.claude/settings.local.json` | Claude Code permissions

---

**Migration Status:** Infrastructure configured, ready for development.  
**Next Action:** Launch VS Code, reopen in container, verify service health.
